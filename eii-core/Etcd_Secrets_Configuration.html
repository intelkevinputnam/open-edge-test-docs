
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EII Etcd Secrets Configuration &#8212; eii-test  documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">eii-test  documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contents:
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../eii-azure-bridge/README.html">
   Azure Bridge
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="README.html">
   EII Core
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../eii-messagebus/README.html">
   EII Message Bus
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/eii-core/Etcd_Secrets_Configuration.md.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#other-x509-certificates">
   Other X509 Certificates
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="eii-etcd-secrets-configuration">
<h1>EII Etcd Secrets Configuration<a class="headerlink" href="#eii-etcd-secrets-configuration" title="Permalink to this headline">¶</a></h1>
<p>Etcd Secrets configuration are done to establish the data path
of various EII containers.</p>
<p>The below are the ENV’s that should be present in the environment section
of every service in <code class="docutils literal notranslate"><span class="pre">build/docker-compose.yml</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="p">[</span><span class="n">service_name</span><span class="p">]:</span>
    <span class="o">...</span>
    <span class="n">environment</span><span class="p">:</span>
        <span class="n">AppName</span><span class="p">:</span> <span class="s2">&quot;app_name&quot;</span> <span class="c1"># required if a unique first level key `/[AppName]` is needed in etcd</span>
    <span class="n">secrets</span><span class="p">:</span>  <span class="c1"># This section needs to be commented out when run in DEV mode. Only needed for PROD mode</span>
        <span class="o">-</span> <span class="n">etcd_ca_certificate</span>
        <span class="o">-</span> <span class="n">app_public_certificate_for_etcd</span>
        <span class="o">-</span> <span class="n">app_private_key_for_etcd</span>
</pre></div>
</div>
<p>Etcd secrets(certs) for all the services of docker compose file will be generated automatically during provisioning.
Post provisioning this secrets should be mentioned in following two places for each service.</p>
<ol>
<li><p>in the <code class="docutils literal notranslate"><span class="pre">secrets</span></code> section at the bottom of <code class="docutils literal notranslate"><span class="pre">build/docker-compose.yml</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">secrets</span><span class="p">:</span>
  <span class="n">etcd_ca_certificate</span><span class="p">:</span>
    <span class="n">file</span><span class="p">:</span> <span class="p">[</span><span class="n">path_to_pem_file</span><span class="p">]</span>
  <span class="n">app_public_certificate_for_etcd</span><span class="p">:</span>
    <span class="n">file</span><span class="p">:</span> <span class="p">[</span><span class="n">path_to_pem_file</span><span class="p">]</span>
  <span class="n">app_private_key_for_etcd</span><span class="p">:</span>
    <span class="n">file</span><span class="p">:</span> <span class="p">[</span><span class="n">path_to_pem_file</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">secrets</span></code> section in for each service.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>: The secret name must follow proper naming convention and file path as below</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
 <span class="n">etcd_</span><span class="o">&lt;</span><span class="n">AppName</span><span class="o">&gt;</span><span class="n">_cert</span><span class="p">:</span>
   <span class="n">file</span><span class="p">:</span> <span class="n">provision</span><span class="o">/</span><span class="n">Certificates</span><span class="o">/&lt;</span><span class="n">AppName</span><span class="o">&gt;/&lt;</span><span class="n">AppName</span><span class="o">&gt;</span><span class="n">_client_certificate</span><span class="o">.</span><span class="n">pem</span>
 <span class="n">etcd_</span><span class="o">&lt;</span><span class="n">AppName</span><span class="o">&gt;</span><span class="n">_key</span><span class="p">:</span>
   <span class="n">file</span><span class="p">:</span> <span class="n">provision</span><span class="o">/</span><span class="n">Certificates</span><span class="o">/&lt;</span><span class="n">AppName</span><span class="o">&gt;/&lt;</span><span class="n">AppName</span><span class="o">&gt;</span><span class="n">_client_key</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
<p>For example, if the AppName is <code class="docutils literal notranslate"><span class="pre">VideoIngestion1</span></code>, secrets must be mentioned as below</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">etcd_VideoIngestion1_cert</span><span class="p">:</span>
  <span class="n">file</span><span class="p">:</span> <span class="n">provision</span><span class="o">/</span><span class="n">Certificates</span><span class="o">/</span><span class="n">VideoIngestion1</span><span class="o">/</span><span class="n">VideoIngestion1_client_certificate</span><span class="o">.</span><span class="n">pem</span>
<span class="n">etcd_VideoIngestion1_key</span><span class="p">:</span>
  <span class="n">file</span><span class="p">:</span> <span class="n">provision</span><span class="o">/</span><span class="n">Certificates</span><span class="o">/</span><span class="n">VideoIngestion1</span><span class="o">/</span><span class="n">VideoIngestion1_client_key</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
<hr class="docutils" />
<p><strong>NOTE</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Telegraf</span></code> service must use <code class="docutils literal notranslate"><span class="pre">InfluxDBConnector</span></code> secrets as it needs access to InfluxDBConnector certs and configs. To enable this please mention InfluxDBConnector AppName as <code class="docutils literal notranslate"><span class="pre">InfluxDBAppName</span></code> in environment section of Telegraf app. Also use secrets of InfluxDBConnector app for Telegraf Service. A seperate certificates for Telegraf app is also generated during provisioning and can be used if needed for storing Telegraf service related configurations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">socket_dir_name</span></code> where unix socket files are created. If <code class="docutils literal notranslate"><span class="pre">&lt;protocol&gt;</span></code> is
<code class="docutils literal notranslate"><span class="pre">zmq/tcp</span></code>, then <code class="docutils literal notranslate"><span class="pre">&lt;endpoint&gt;</span></code> has to be the combination of <code class="docutils literal notranslate"><span class="pre">&lt;hostname&gt;:&lt;port&gt;</span></code>.</p></li>
</ul>
<hr class="docutils" />
<div class="section" id="other-x509-certificates">
<h2>Other X509 Certificates<a class="headerlink" href="#other-x509-certificates" title="Permalink to this headline">¶</a></h2>
<p>If any of the Services needs to generate other X509 Certificates(pem or der format), please use below option and provisioining will generate certificates and put them in ETCD key for the App.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="p">[</span><span class="n">service_name</span><span class="p">]:</span>
    <span class="o">...</span>
    <span class="n">environment</span><span class="p">:</span>
      
      <span class="c1"># Only required in PROD mode</span>
      <span class="n">CertType</span><span class="p">:</span> <span class="s2">&quot;pem&quot;</span> <span class="ow">or</span> <span class="s2">&quot;der&quot;</span>
  
</pre></div>
</div>
</div>
</div>


              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By various<br/>
        
            &copy; Copyright 2021, various.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>